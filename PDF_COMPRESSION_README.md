# üóúÔ∏è –°–∂–∞—Ç–∏–µ PDF —Ñ–∞–π–ª–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∂–∞—Ç–∏—è PDF —Ñ–∞–π–ª–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–µ–±-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## üéØ –¶–µ–ª—å

–°–∂–∏–º–∞—Ç—å –±–æ–ª—å—à–∏–µ PDF —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 143 –ú–ë) –¥–æ –±–æ–ª–µ–µ –ø—Ä–∏–µ–º–ª–µ–º—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è –≤–µ–±-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞.

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ** - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ PDF —Ñ–∞–π–ª–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ —Ä–∞–∑–º–µ—Ä
2. **–£–º–Ω–æ–µ —Å–∂–∞—Ç–∏–µ** - –ï—Å–ª–∏ —Ñ–∞–π–ª –±–æ–ª—å—à–µ 10 –ú–ë, —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–∂–∞—Ç—ã—Ö –≤–µ—Ä—Å–∏–π** - –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ PDF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è, –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤** - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ 20%
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∂–∞—Ç–∏—è
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**: 10 –ú–ë (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ö–∞—á–µ—Å—Ç–≤–æ**: 75% (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–§–æ—Ä–º–∞—Ç**: PNG –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
files/
‚îú‚îÄ‚îÄ pdf_utils.py                    # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PDF
‚îú‚îÄ‚îÄ management/commands/
‚îÇ   ‚îî‚îÄ‚îÄ compress_pdfs.py           # Django –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–∂–∞—Ç–∏—è
‚îî‚îÄ‚îÄ models.py                      # –ú–æ–¥–µ–ª—å File —Å –ø–æ–ª—è–º–∏ –¥–ª—è —Å–∂–∞—Ç—ã—Ö PDF

compress_existing_pdfs.py          # –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∂–∞—Ç–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö PDF
test_pdf_compression.py           # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

PDF —Ñ–∞–π–ª—ã —Å–∂–∏–º–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ –∏—Ö —Ä–∞–∑–º–µ—Ä –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10 –ú–ë.

### 2. –°–∂–∞—Ç–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö PDF —Ñ–∞–π–ª–æ–≤

```bash
# Django –∫–æ–º–∞–Ω–¥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python manage.py compress_pdfs

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python manage.py compress_pdfs --max-size 5 --quality 80 --force

# –ü—Ä–æ—Å–º–æ—Ç—Ä –±–µ–∑ —Å–∂–∞—Ç–∏—è
python manage.py compress_pdfs --dry-run

# –ü—Ä—è–º–æ–π Python —Å–∫—Ä–∏–ø—Ç
python compress_existing_pdfs.py
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python test_pdf_compression.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö

### –í –ª–æ–≥–∞—Ö
```
PDF —Å–∂–∞—Ç: 123456 - 143.2MB ‚Üí 12.5MB (91.3%)
```

### HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
```
X-Compressed-PDF: true
X-Original-Size: 150000000
X-Compressed-Size: 13000000
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∂–∞—Ç–∏—è –≤ –∫–æ–¥–µ

```python
# –í files/views.py
if should_compress_pdf(file_instance.file.path, max_size_mb=10):
    success, compressed_path, compressed_size = compress_pdf(
        file_instance.file.path,
        quality=75,  # –ö–∞—á–µ—Å—Ç–≤–æ 1-100
        max_size_mb=10  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –ú–ë
    )
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Django –∫–æ–º–∞–Ω–¥—É

```bash
python manage.py compress_pdfs --max-size 5 --quality 80
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∂–∞—Ç–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```python
from files.models import File

file_obj = File.objects.get(code='123456')
print(f"–ï—Å—Ç—å —Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è: {file_obj.has_compressed_pdf()}")
print(f"–†–∞–∑–º–µ—Ä —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏: {file_obj.get_compressed_pdf_size_mb()} –ú–ë")
print(f"–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è: {file_obj.get_compression_ratio()}%")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ñ–∞–π–ª–∞
2. –í —Ä–∞–∑–¥–µ–ª–µ "–†–∞–∑–º–µ—Ä" –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∂–∞—Ç–∏–∏
3. –ó–µ–ª–µ–Ω—ã–π –∑–Ω–∞—á–æ–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### PyMuPDF –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```bash
pip install PyMuPDF==1.23.14
```

### –û—à–∏–±–∫–∏ —Å–∂–∞—Ç–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–∞–º

### –§–∞–π–ª—ã –Ω–µ —Å–∂–∏–º–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 10 –ú–ë)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª - —ç—Ç–æ PDF
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–°–∂–∞—Ç–∏–µ**: 70-90% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏**: –£–ª—É—á—à–µ–Ω–∏–µ –≤ 5-10 —Ä–∞–∑
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –ü—Ä–∏–µ–º–ª–µ–º–æ–µ –¥–ª—è –≤–µ–±-–ø—Ä–æ—Å–º–æ—Ç—Ä–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –°–∂–∏–º–∞–π—Ç–µ PDF —Ñ–∞–π–ª—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –°–∂–∞—Ç—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ–±-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∂–∞—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
INFO: PDF —Å–∂–∞—Ç: 123456 - 143.2MB ‚Üí 12.5MB (91.3%)
WARNING: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∂–∞—Ç—å PDF 123456: [–æ—à–∏–±–∫–∞]
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≤–∞—à PDF —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º 143 –ú–ë –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞—Ç—å—Å—è –¥–æ ~10-20 –ú–ë –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–µ–±-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø—Ä–∏ —ç—Ç–æ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è!
